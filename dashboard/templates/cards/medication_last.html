{% extends 'cards/base.html' %}
{% load duration i18n %}
{% block header %}
    <a href="{% url "core:medication-list" %}">{% trans "Last Medication" %}</a>
{% endblock %}
{% block title %}
    {% if medication %}
        <div>
            {% blocktrans trimmed with time_ago=medication.time|deltasince|duration_string:'m' %}
                {{ time_ago }} ago
            {% endblocktrans %}
        </div>
        <small>{{ medication.time|time }}</small>
    {% else %}
        {% trans "None" %}
    {% endif %}
{% endblock %}
{% block content %}
    {% if medication %}
        {# djlint:off #}{{ medication.name }}{% if medication.amount %} ({{ medication.amount }}{% if medication.amount_unit %} {{ medication.amount_unit }}{% endif %}){% endif %}{# djlint:on #}
    {% endif %}
{% endblock %}
{% block listgroup %}
    {% if pending %}
        <ul class="list-group list-group-flush">
            {% for item in pending %}
                <li class="list-group-item d-flex justify-content-between align-items-center py-2{% if item.overdue %} list-group-item-warning{% endif %}">
                    <div>
                        <strong>{{ item.schedule.name }}</strong>
                        <br>
                        {% if item.overdue %}
                            <small class="text-warning">
                                <i class="icon-clock" aria-hidden="true"></i>
                                {% if item.has_specific_time %}
                                    {% trans "overdue" %} ({{ item.due_time|time:"H:i" }})
                                {% else %}
                                    {% trans "overdue" %}
                                {% endif %}
                            </small>
                        {% elif item.has_specific_time %}
                            <small class="text-muted">
                                <i class="icon-clock" aria-hidden="true"></i>
                                {% trans "due at" %} {{ item.due_time|time:"H:i" }}
                            </small>
                        {% else %}
                            <small class="text-muted">
                                <i class="icon-clock" aria-hidden="true"></i>
                                {% trans "due today" %}
                            </small>
                        {% endif %}
                    </div>
                    <span>
                        {% if not item.overdue and item.has_specific_time %}
                            <button type="button"
                                    class="btn btn-sm btn-outline-warning"
                                    data-bs-toggle="modal"
                                    data-bs-target="#confirm-give-{{ item.schedule.id }}"
                                    title="{% trans "Give early" %}">
                                <i class="icon-true" aria-hidden="true"></i>
                            </button>
                        {% else %}
                            <form method="post"
                                  action="{% url 'core:medication-give' item.schedule.id %}"
                                  class="d-inline">
                                {% csrf_token %}
                                <button type="submit"
                                        class="btn btn-sm btn-outline-success"
                                        title="{% trans "Give now" %}">
                                    <i class="icon-true" aria-hidden="true"></i>
                                </button>
                            </form>
                        {% endif %}
                        <a href="{% url 'core:medication-add' %}?name={{ item.schedule.name }}"
                           class="btn btn-sm btn-outline-primary"
                           title="{% trans "Add with details" %}">
                            <i class="icon-update" aria-hidden="true"></i>
                        </a>
                    </span>
                </li>
            {% endfor %}
        </ul>
        {% for item in pending %}
            {% if not item.overdue and item.has_specific_time %}
                <div class="modal fade"
                     id="confirm-give-{{ item.schedule.id }}"
                     tabindex="-1"
                     aria-hidden="true">
                    <div class="modal-dialog modal-sm">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title text-body">
                                    <i class="icon-medication" aria-hidden="true"></i>
                                    {% trans "Give early?" %}
                                </h5>
                                <button type="button"
                                        class="btn-close"
                                        data-bs-dismiss="modal"
                                        aria-label="{% trans "Close" %}"></button>
                            </div>
                            <div class="modal-body text-body">
                                {% blocktrans trimmed with name=item.schedule.name time=item.due_time|time:"H:i" %}
                                    {{ name }} is not due until {{ time }}.
                                    Are you sure you want to give it now?
                                {% endblocktrans %}
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{% trans "Cancel" %}</button>
                                <form method="post"
                                      action="{% url 'core:medication-give' item.schedule.id %}"
                                      class="d-inline">
                                    {% csrf_token %}
                                    <button type="submit" class="btn btn-warning">{% trans "Give now" %}</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            {% endif %}
        {% endfor %}
    {% endif %}
{% endblock %}
