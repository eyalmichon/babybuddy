{% load i18n %}
{% if not empty or not hide_empty %}
    <div class="card card-dashboard card-{{ type }}">
        <div class="card-header">
            <i class="icon-{{ type }} pull-left" aria-hidden="true"></i>
            <a href="{% url "core:medication-list" %}">{% trans "Medications" %}</a>
        </div>
        <div class="card-body">
            <span class="card-title"><strong>
                {% if overdue_count > 0 %}
                    {% blocktrans count counter=overdue_count %}
                        {{ counter }} medication overdue
                    {% plural %}
                        {{ counter }} medications overdue
                    {% endblocktrans %}
                {% elif medications %}
                    {% trans "All medications on track" %}
                {% else %}
                    {% trans "No medications scheduled" %}
                {% endif %}
            </strong></span>
        </div>
        {% if medications %}
            <ul class="list-group list-group-flush">
                {% for item in medications %}
                    <li class="list-group-item d-flex justify-content-between align-items-center{% if item.overdue %} list-group-item-warning{% elif item.given %} list-group-item-success{% endif %}">
                        <div>
                            <strong>{{ item.schedule.name }}</strong>
                            {% if item.schedule.amount %}
                                <small class="text-muted">
                                    ({{ item.schedule.amount }}
                                    {% if item.schedule.amount_unit %}{{ item.schedule.amount_unit }}{% endif %}
                                    )
                                </small>
                            {% endif %}
                            <br>
                            {% if item.given %}
                                <small class="text-success">
                                    <i class="icon-true" aria-hidden="true"></i>
                                    {% trans "Given at" %} {{ item.given_entry.time|time:"H:i" }}
                                </small>
                            {% elif item.overdue %}
                                <small class="text-warning">{% trans "Due at" %} {{ item.due_time|time:"H:i" }} &mdash; {% trans "overdue!" %}</small>
                            {% else %}
                                <small class="text-muted">{% trans "Due at" %} {{ item.due_time|time:"H:i" }}</small>
                            {% endif %}
                        </div>
                        <div class="btn-group btn-group-sm">
                            {% if not item.given %}
                                <form method="post"
                                      action="{% url 'core:medication-give' item.schedule.id %}"
                                      class="d-inline">
                                    {% csrf_token %}
                                    <button type="submit"
                                            class="btn btn-sm btn-success"
                                            title="{% trans "Give now" %}">
                                        <i class="icon-true" aria-hidden="true"></i>
                                    </button>
                                </form>
                            {% endif %}
                            <a href="{% url 'core:medication-add' %}?name={{ item.schedule.name }}"
                               class="btn btn-sm btn-outline-primary"
                               title="{% trans "Add with details" %}">
                                <i class="icon-update" aria-hidden="true"></i>
                            </a>
                        </div>
                    </li>
                {% endfor %}
            </ul>
        {% endif %}
    </div>
{% endif %}
